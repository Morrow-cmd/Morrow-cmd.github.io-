<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>КИПИШ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @font-face {
            font-family: 'Ordina';
            src: url('font/Ordina-Medium.woff') format('woff'),
                 url('font/Ordina-Medium.woff2') format('woff2'),
                 url('font/Ordina-Medium.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Inter', sans-serif;
            text-align: center;
        }
        .hidden { display: none; }
        .container { max-width: 600px; margin: auto; padding: 20px; }
        .btn-submit { background-color: #FF00EA; color: black; font-size: 1.2rem; font-weight: bold; padding: 10px 30px; border: none; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<!-- Страница 1: index.html -->
<div id="indexPage">
    <style>
        @font-face {
            font-family: 'Ordina';
            src: url('font/Ordina-Medium.woff') format('woff'),
                 url('font/Ordina-Medium.woff2') format('woff2'),
                 url('font/Ordina-Medium.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Ordina', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .container1 {
            max-width: 600px;
            width: 100%;
        }
        .title1 {
            color: #FF00EA;
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 50px;
        }
        .event-title {
            font-size: 2rem;
            font-weight: bold;
        }
        .event-date {
            font-size: 1.2rem;
            margin-bottom: 40px;
            color: #ccc;
            font-family: Inter, sans-serif;
        }
        .ticket-section {
            background: #11111100;
            padding: 5px;
            border: 1px solid #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            font-family: Inter, sans-serif;
        }
        .ticket-label {
            font-size: 1.2rem;
        }
        .ticket-price {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .quantity-control {
            display: flex;
            align-items: center;
        }
        .quantity-btn {
            background: #FF00EA;
            color: #000;
            border: none;
            font-size: 1rem;
            width: 30px;
            height: 30px;
            font-weight: bold;
            font-family: Inter, sans-serif;
        }
        .quantity-input {
            background: #000;
            color: #fff;
            border: none;
            text-align: center;
            width: 40px;
            margin: 0 5px;
        }
        .total-price {
            font-size: 2rem;
            font-weight: bold;
            margin-right: 20px;
        }
        .btn-buy {
            background-color: #FF00EA;
            color: black;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 0px;
            border: none;
        }
        .description-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 30px;
        }
        .description-text {
            font-size: 1rem;
            text-align: center;
            color: #ccc;
            font-family: Inter, sans-serif;
        }
        .footer {
            margin-top: 30px;
            font-size: 0.8rem;
            text-align: center;
            color: #555;
            margin-top: 70px;
            display: flex;
            align-items: center;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: Inter, sans-serif;
        }
        .b500 {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        .v{
            margin-left: 20px;
            width: 20%;
        }
        .v1{
            width: 6%;
        }
        .logs {
            margin-bottom: 5%;
        }
        .lincs{
            max-width: 250px;
            display: flex;
            width: 100%;
            justify-content: space-between;
        }
        a{
            text-decoration: none;
            color: #fff;
            font-size: 1rem;
            font-weight: 400;
        }
    </style>
</head>
<body>
<div class="title1">Рахат</div>
<div class="logs">
    <img src="img/Vector.svg" alt="" class="v1">
    <img src="img/v.svg" alt="" class="v">
</div>
<div class="container1">
    
    
    <div class="event-title">Покупка билета на <br> “КИПИШ 1”</div>
    <div class="event-date">15 марта, Метро Пушкина</div>

    <div class="ticket-section">
        <span class="ticket-label">Стандартный билет</span>
        <span class="ticket-price">500 ₽</span>
        <div class="quantity-control">
            <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
            <input type="text" id="quantity" class="quantity-input" value="1" readonly>
            <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
        </div>
    </div>
    <div class="b500">
        <div class="total-price">500 ₽</div>
        <button class="btn btn-buy" onclick="goToForm()">Далее</button>

        <script>
            function changeQuantity(amount) {
                var quantityInput = document.getElementById("quantity");
                if (!quantityInput) {
                    console.error("Поле количества не найдено!");
                    return;
                }
            
                var currentQuantity = parseInt(quantityInput.value) || 1;
                var newQuantity = currentQuantity + amount;
                
                if (newQuantity < 1) newQuantity = 1;
            
                quantityInput.value = newQuantity;
                document.querySelector(".total-price").textContent = (500 * newQuantity) + " ₽";
            }
            
            function goToForm() {
                var quantityInput = document.getElementById("quantity");
                if (!quantityInput) {
                    console.error("Поле количества не найдено!");
                    return;
                }
            
                var quantity = quantityInput.value;
                var totalPrice = 500 * quantity;
            
                console.log("Переход на форму с параметрами: quantity=" + quantity + ", total=" + totalPrice);
            
                // Открываем новую страницу с параметрами
                window.location.href = "form.html?quantity=" + encodeURIComponent(quantity) + "&total=" + encodeURIComponent(totalPrice);
            }
            </script>
    </div>

    <div class="description-title">О мероприятии</div>
    <div class="description-text">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam lectus risus, finibus ornare vestibulum et,
        feugiat quis dui. Vivamus sit amet dolor et magna facilisis rhoncus. Curabitur maximus est sed porta scelerisque. 
        Sed suscipit, arcu volutpat feugiat posuere, eros nisi tristique nibh, mollis vehicula lectus tortor eu purus.
    </div>


</div>
    <div class="footer">
        <div class="lincs">
        <a href="#">ТГ КАНАЛ</a>
        <a href="#">ТЕХ ПОДДЕРЖКА</a>
        </div>
        ИП ТЕРЕХИН ПАВЕЛ ЕВГЕНЬЕВИЧ (ИНН: 165609296354)
    </div>
<script>
    function changeQuantity(amount) {
        var quantityInput = document.getElementById("quantity");
        var totalPriceElement = document.querySelector(".total-price");

        var currentQuantity = parseInt(quantityInput.value) || 1;
        var newQuantity = currentQuantity + amount;
        if (newQuantity < 1) newQuantity = 1;

        quantityInput.value = newQuantity;
        var total = 500 * newQuantity;
        totalPriceElement.textContent = total + " ₽";
    }

    function goToForm() {
        var quantity = document.getElementById("quantity").value;
        var total = 500 * quantity;

        window.location.href = "form.html?quantity=" + quantity + "&total=" + total;
    }
</script>
<script>
    function changeQuantity(amount) {
        let quantityInput = document.getElementById("quantity");
        let currentQuantity = parseInt(quantityInput.value);
        let newQuantity = currentQuantity + amount;
        
        if (newQuantity < 1) newQuantity = 1;

        quantityInput.value = newQuantity;
        document.querySelector(".total-price").textContent = (500 * newQuantity) + " ₽";
    }
</script>

</div>

<!-- Страница 2: form.html -->
<div id="formPage" class="hidden">
     <style>
        @font-face {
            font-family: 'Ordina';
            src: url('font/Ordina-Medium.woff') format('woff'),
                 url('font/Ordina-Medium.woff2') format('woff2'),
                 url('font/Ordina-Medium.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #000;
            color: #fff;
            font-family: Inter, sans-serif;
            text-align: center;
        }
        .container2 {
            max-width: 400px;
            margin-top: 5vh;
        }
        input {
            background: #000;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 10px;
            width: 100%;
            margin-bottom: 10px;
        }
        .promo-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        #discount-label {
            position: absolute;
            right: 10px;
            top: 40%;
            transform: translateY(-50%);
            background-color: #FF00EA;
            color: rgb(0, 0, 0);
            padding: 2px 5px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
            font-weight: bold;
        }
        .btn-submit {
            background-color: #FF00EA;
            color: black;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px 30px;
            border: none;
            width: 100%;
            margin-top: 10px;
        }
        p {
            margin: 0;
            text-align: left;
        }
        #total-price{
            color: #FF00EA;
            font-size: 25px;
            font-weight: bold;
        }
        .y{
            font-size: 25px;
        }
    </style>
</head>
<body>
    
<h1 class="text">РАХАТ</h1>
<div class="container2">
    
    <h2 class="text2">Данные для <br>получения билета</h2>
    <form id="ticketForm">
        <p>Имя</p>
        <input type="text" id="name" placeholder="Иван Иванов" required>
        <p>Номер телефона</p>
        <input type="tel" id="phone" placeholder="+7 (939) 339-99-99" required>
        <p>Телеграмм для связи</p>
        <input type="text" id="telegram" placeholder="@username" required>
        
        <p>Промокод</p>
        <div class="promo-container">
            <input type="text" id="promo" placeholder="Введите промокод">
            <span id="discount-label"></span>
        </div>

        <p class="y">Итого: <span id="total-price">500</span> ₽</p>
        
        <button type="submit" class="btn btn-submit">Далее</button>
    </form>
</div>
<div class="footer">
    <div class="lincs">
    <a href="#">ТГ КАНАЛ</a>
    <a href="#">ТЕХ ПОДДЕРЖКА</a>
    </div>
    ИП ТЕРЕХИН ПАВЕЛ ЕВГЕНЬЕВИЧ (ИНН: 165609296354)
</div>
<script>
    let ticketPrice = 500;
let quantity = 1;
let totalPrice = ticketPrice;

// Функция обновления цены при изменении количества билетов
function updateTotal() {
    quantity = document.getElementById("quantity").value;
    totalPrice = ticketPrice * quantity;
    document.getElementById("totalPrice").textContent = totalPrice;
}

// Функция перехода на форму
function goToForm() {
    quantity = document.getElementById("quantity").value;
    totalPrice = ticketPrice * quantity;

    // Сохраняем данные в localStorage
    localStorage.setItem("quantity", quantity);
    localStorage.setItem("totalPrice", totalPrice);

    // Показываем форму, скрываем первую страницу
    document.getElementById("indexPage").classList.add("hidden");
    document.getElementById("formPage").classList.remove("hidden");

    // Обновляем данные на странице формы
    document.getElementById("selectedQuantity").textContent = quantity;
    document.getElementById("selectedTotalPrice").textContent = totalPrice;
}

// Функция перехода на последнюю страницу
document.getElementById("ticketForm").addEventListener("submit", function(event) {
    event.preventDefault();

    // Показываем третью страницу, скрываем вторую
    document.getElementById("formPage").classList.add("hidden");
    document.getElementById("mainPage").classList.remove("hidden");
});

// При загрузке формы восстанавливаем данные из localStorage
document.addEventListener("DOMContentLoaded", function () {
    if (localStorage.getItem("quantity")) {
        quantity = localStorage.getItem("quantity");
        totalPrice = localStorage.getItem("totalPrice");
        document.getElementById("selectedQuantity").textContent = quantity;
        document.getElementById("selectedTotalPrice").textContent = totalPrice;
    }
});
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        function getQueryParam(param) {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        var totalPriceElement = document.getElementById("total-price");
        var promoInput = document.getElementById("promo");
        var discountLabel = document.getElementById("discount-label");

        var basePrice = parseFloat(getQueryParam("total")) || 500;
        totalPriceElement.textContent = basePrice;

        var promoCodes = {
            "VOTAKOI": 0.1,
            "SUPER50": 0.1,
            "DISCOUNT20": 0.1
        };

        promoInput.addEventListener("input", function () {
            var promoCode = promoInput.value.trim().toUpperCase();
            var discount = promoCodes[promoCode] || 0
            var discountedTotal = basePrice - (basePrice * discount);
            totalPriceElement.textContent = Math.round(discountedTotal);

            if (discount > 0) {
                discountLabel.textContent = "-" + (discount * 100) + "%";
                discountLabel.style.display = "block";
            } else {
                discountLabel.style.display = "none";
            }
        });
    });
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Получаем параметры из URL
    const urlParams = new URLSearchParams(window.location.search);
    const quantity = urlParams.get('quantity');
    const totalPrice = urlParams.get('total');

    // Проверяем, если параметры есть в URL
    if (!quantity || !totalPrice) {
        console.error("Не удалось получить параметры из URL.");
        return;
    }

    // Теперь quantity и totalPrice можно использовать
    console.log("Количество:", quantity);
    console.log("Общая сумма:", totalPrice);

    var form = document.getElementById("ticketForm");

    form.addEventListener("submit", function(event) {
        event.preventDefault();
        console.log("Событие submit сработало!");

        // Собираем остальные данные формы
        var name = document.getElementById("name").value;
        var phone = document.getElementById("phone").value;
        var telegram = document.getElementById("telegram").value;
        var promo = document.getElementById("promo").value.trim() === "" ? "Нет промокода" : document.getElementById("promo").value;

        console.log("Данные формы:", { name, phone, telegram, promo, quantity, totalPrice });

        // Код отправки в Telegram
        var botToken = "6211414542:AAGbIdZ2IRat7fXPMdDl-YTXuuQPfTRRgl8";
        var chatId = "1366351508";
        var message = "📩 Новый заказ билета\n\n" +
                      "👤 Имя: " + name + "\n" +
                      "📞 Телефон: " + phone + "\n" +
                      "💬 Telegram: " + telegram + "\n" +
                      "🎫 Количество билетов: " + quantity + "\n" +
                      "💰 Общая сумма: " + totalPrice + "\n" +
                      "🎟 Промокод: " + promo;

        var url = 'https://api.telegram.org/bot' + botToken + '/sendMessage?chat_id=' + chatId + '&text=' + encodeURIComponent(message) + '&parse_mode=HTML';

        fetch(url)
            .then(function(response) { return response.json(); })
            .then(function(data) {
                if (data.ok) {
                    alert("Данные отправлены в Telegram!");
                    form.reset();
                    window.location.href = "main.html"; // Перенос на след. страницу
                } else {
                    alert("Ошибка при отправке. Проверьте настройки бота.");
                }
            })
            .catch(function(error) {
                alert("Ошибка сети: " + error.message);
            });
    });
});
</script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                var phoneInput = document.getElementById("phone");
                var nameInput = document.getElementById("name");
                var telegramInput = document.getElementById("telegram");
            
                // Функция для форматирования номера
                function formatPhone(value) {
                    var numbers = value.replace(/\D/g, ""); // Удаляем всё, кроме цифр
            
                    // Гарантируем, что номер начинается с 7
                    if (numbers.length === 0 || numbers[0] !== "7") {
                        numbers = "7" + numbers;
                    }
            
                    var formatted = "+7 ";
                    if (numbers.length > 1) formatted += "(" + numbers.slice(1, 4);
                    if (numbers.length >= 5) formatted += ") " + numbers.slice(4, 7);
                    if (numbers.length >= 8) formatted += "-" + numbers.slice(7, 9);
                    if (numbers.length >= 10) formatted += "-" + numbers.slice(9, 11);
            
                    return formatted;
                }
            
                // Обработчик ввода номера
                phoneInput.addEventListener("input", function (event) {
                    var value = event.target.value;
                    phoneInput.value = formatPhone(value);
                });
            
                // Блокировка удаления +7
                phoneInput.addEventListener("keydown", function (event) {
                    if ((event.key === "Backspace" || event.key === "Delete") && phoneInput.value.length <= 4) {
                        event.preventDefault();
                    }
                });
            
                // Фильтрация имени (только 2 слова на русском)
                nameInput.addEventListener("input", function () {
                    var value = nameInput.value.trim();
                    var words = value.split(/\s+/).filter(word => word.length > 0);
            
                    // Оставляем только русские буквы
                    value = words.map(word => word.replace(/[^а-яА-ЯёЁ]/g, "")).join(" ");
            
                    if (words.length > 2) {
                        value = words.slice(0, 2).join(" ");
                    }
            
                    nameInput.value = value;
                });
            
                // Фильтрация Telegram username
                telegramInput.addEventListener("input", function () {
                    var value = telegramInput.value.trim();
            
                    if (!value.startsWith("@")) {
                        value = "@" + value;
                    }
            
                    // Разрешаем только @, латиницу, цифры и _
                    value = value.replace(/[^@a-zA-Z0-9_]/g, "");
            
                    telegramInput.value = value;
                });
            });
            </script>
</div>

<!-- Страница 3: main.html -->
<div id="mainPage" class="hidden">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        @font-face {
        font-family: 'Ordina';
        src: url('font/Ordina-Medium.woff') format('woff'),
            url('font/Ordina-Medium.woff2') format('woff2'),
            url('font/Ordina-Medium.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
        }
        .text3{
            color: #FF00EA;
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            font-family: Ordina, sans-serif;
        }
        .text4{
            font-weight: bold;
            text-align: center;
            font-size: 2rem;
            font-family: Ordina, sans-serif;
        }
        body {
            background-color: #000;
            color: #fff;
            font-family: Inter, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 400px;
            margin-top: 25vh;
            margin-bottom: 30vh;
        }
        input {
            background: #000;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 10px;
            width: 100%;
            margin-bottom: 10px;
        }
        .btn-submit {
            background-color: #FF00EA;
            color: black;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 0;
            border: none;
            width: 100%;
            margin-top: 10%;
        }
        .lincs{
            max-width: 250px;
            display: flex;
            width: 100%;
            justify-content: space-between;
        }
        a{
            text-decoration: none;
            color: #fff;
            font-size: 1rem;
            font-weight: 400;
        }
        .footer {
            margin-top: 30px;
            font-size: 0.8rem;
            text-align: center;
            color: #555;
            margin-top: auto;
            display: flex;
            align-items: center;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: 15%;
        }
        .p1{
            margin: 0;
            text-align: center;
        }
    </style>
</head>
<body>
<h1 class="text3">РАХАТ</h1>
<div class="container">
    
    <h2 class="text4">Отлично, осталось совсем немного!🎉</h2>
    <p class="p1">Напишите менеджеру и оплатите билет</p>
    <button type="submit" class="btn btn-submit" >Далее</button>
    
</div>
<div class="footer">
    <div class="lincs">
    <a href="#">ТГ КАНАЛ</a>
    <a href="#">ТЕХ ПОДДЕРЖКА</a>
    </div>
    ИП ТЕРЕХИН ПАВЕЛ ЕВГЕНЬЕВИЧ (ИНН: 165609296354)
</div>
</div>

<script>
    function goToForm() {
        let quantity = document.getElementById("quantity").value;
        let totalPrice = 500 * quantity;

        document.getElementById("indexPage").classList.add("hidden");
        document.getElementById("formPage").classList.remove("hidden");
    }

    document.getElementById("ticketForm").addEventListener("submit", function(event) {
        event.preventDefault();
        document.getElementById("formPage").classList.add("hidden");
        document.getElementById("mainPage").classList.remove("hidden");
    });
</script>

</body>
</html>
